name: api-gateway
imagename: api-gateway
namespace: bbsoft


service:
  type: ClusterIP
  port: 8080


deployment:
  podAntiAffinity: true
  replica: 1
  imagePullSecrets:
    - docker-registry-secret
  probe:
    livenessProbe:
      enable: true
      probeType: http
      http:
        path: /actuator/health/liveness
        port: 8080
    readinessProbe:
      enable: true
      initialDelaySeconds: 10
      probeType: http
      http:
        path: /actuator/health/readiness
        port: 8080
  resources:
    requests:
      cpu: 500m
      memory: 1Gi
      ephemeral-storage: 1Gi
    limits:
      cpu: 1
      ephemeral-storage: 2560Mi
      memory: 2560Mi
  restartPolicy: Always
  env:
    JAVA_TOOL_OPTIONS: '-Xmx2000m -XX:ParallelGCThreads=2 -XX:CICompilerCount=2 --enable-preview'
    SERVER_PORT: '8080'
    ROUTING_BACKOFFICE_URL: 'http://backoffice-svc:8080'
    ROUTING_BACKOFFICE_PAYSTACK_LISTENER_PATH: '/api/v2/payments/withdraw/paystack/listener'
    ROUTING_LOTTERY_URL: 'http://application-svc:8080'
    ROUTING_NOTIFICATION-DISPATCHER_URL: 'http://notification-svc:8080'
    ROUTING_PURCHASE-SERVICE_URL: 'http://purchase-service-svc:8080'
    ROUTING_PURCHASE-SERVICE_PAYSTACK-LISTENER-PATH: '/api/v2/payments/nig/purchase/paystack/transactions/listener'
    ROUTING_DWH-SERVICE_URL: 'http://dwh-service-svc:8080'
    SECURITY_CORS_ORIGINS: '*,https://game-api-preprod.bbsoft.by, https://apigateway-preprod.bbsoft.by'
    MANAGEMENT_METRICS_EXPORT_STATSD_ENABLED: "True"
    MANAGEMENT_METRICS_EXPORT_STATSD_HOST: 'telegraf-udp-lottery.mon.svc.cluster.local'
    MANAGEMENT_METRICS_CUSTOM_TAGS_SOURCE: 'api-gateway'
    DATASOURCE_BELLOTO_DATABASE: 'postgres'
    DATASOURCE_BELLOTO_POOL_SIZE: '20'
    APPLICATION_ZONE-NAME: 'Europe/Minsk'
    APPLICATION_LOCALE: 'ru_RU'
    APPLICATION_DATE-TIME-FORMATTER: 'dd/MM/yyyy HH:mm:ss'
    APPLICATION_CURRENCY: 'BYN'
    ROUTING_PLATFORM-SERVICE_URL: 'http://platform-service-svc.bbsoft.svc.cluster.local:8080'
    DATASOURCE_BELLOTO_URL: 'jdbc:postgresql://postgres-bbsoft-main-preprod-master.bbsoft.svc.cluster.local/postgres'
    KAFKA_ENABLED: 'false'
    SWAGGER_ENABLED: 'true'
    SWAGGER_PASSWORD: 'Win13bln'
  envFromSecret:
    JWT_KEY:
      platform-service-ssl: ssl
    DATASOURCE_BELLOTO_ADDRESS:
      postgres-bbsoft-main-preprod-write: host
    DATASOURCE_BELLOTO_PORT:
      postgres-bbsoft-main-preprod-write: port
    DATASOURCE_BELLOTO_USERNAME:
      postgres-bbsoft-main-preprod-admin: superuser
    DATASOURCE_BELLOTO_PASSWORD:
      postgres-bbsoft-main-preprod-admin: superuser-password
    KAFKA_ADDRESS:
      kafka-bbsoft-main-preprod-write: host

ingress:
  enable: true
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/configuration-snippet: 'real_ip_header X-Forwarded-For; real_ip_recursive on;'
  hosts:
  - host: apigateway-preprod.bbsoft.by
    paths:
      - path: /
        pathType: Prefix


hpa:
  enable: false